#!/usr/bin/env ruby

# Trap interrupts to quit cleanly. See
# https://twitter.com/mitchellh/status/283014103189053442
old_sig = Signal.trap('INT') do
  old_sig.call
  exit 1
end

require_relative '../lib/screenplay'
require 'gli'

include GLI::App

program_desc 'sdjsdkf sdflkj'


desc 'Rewind changes from a sketch'
long_desc <<-DESC
Changes from screenplay can be undone using this command and a set of changes
files.  By default, these changes files are saved as YAML to the
"screenplay-shows/" directory (relative to where screenplay is run from).
DESC
command :rewind do |cmd|
  cmd.action do |_, _, change_files|
    Screenplay.rewind(change_files)
  end
end

command :sketch do |cmd|
  cmd.action do |_, _, args|
    sketch_file = if args.empty? && File.exists?(File.expand_path 'config/screenplay.rb')
      File.expand_path('config/screenplay.rb')
    else
      args.first
    end

    sketch_content = File.read(sketch_file)
    eval(sketch_content)
  end
end

exit run(ARGV)
